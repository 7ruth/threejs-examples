<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>texture</title>
<style>
body{
	margin:0;
	padding:0;
	overflow:hidden;
	background:#333;
}
</style>
<script src="../lib/Three_r50.min.js"></script>
<script src="../lib/dat.gui.min.js"></script>
<script>
// https://github.com/mrdoob/three.js/blob/master/src/materials/MeshPhongMaterial.js
window.addEventListener("DOMContentLoaded", function(){

	var materialStatus = {
		material : 'MeshPhongMaterial',
		option   : {
			color : '#ffffff',
			ambient : '#ffffff',
			emissive : '#000000',
			specular : '#111111',
			shininess : 30,
			opacity : 1,
			map : 'null',
			bumpMap : 'null',
			bumpScale : 1,

			reflectivity : 1.0,
			refractionRatio : 0.98,

			shading : 'SmoothShading',
			depthTest : false,

			wireframe : false,
			wireframeLinewidth : 1,

			visible : true,

		},
	}

	var setting = {
		material : {
			MeshNormalMaterial  : THREE.MeshNormalMaterial,
			MeshBasicMaterial   : THREE.MeshBasicMaterial,
			MeshLambertMaterial : THREE.MeshLambertMaterial,
			MeshPhongMaterial   : THREE.MeshPhongMaterial,
			MeshDepthMaterial   : THREE.MeshDepthMaterial,
		}
	}
	
	var width = window.innerWidth;
	var height = window.innerHeight;

	var renderer = new THREE.WebGLRenderer();
	renderer.setSize( width, height );
	document.body.appendChild( renderer.domElement );

	var scene = new THREE.Scene();

	var camera = new THREE.PerspectiveCamera( 40, width / height, 1, 1000 );
	camera.lookAt( new THREE.Vector3( 0, 0, 0) );
	scene.add( camera );

	var light = new THREE.PointLight( 0xffffff, 1 );
	light.position.set( 50, 50, 50 );
	scene.add( light );

	var mesh = new THREE.Mesh(
		new THREE.SphereGeometry( 10, 20, 20 ),
		new THREE.MeshPhongMaterial({ map: THREE.ImageUtils.loadTexture('./dummy.png')})
    );
	scene.add( mesh );

	// render once to enable map texture
	renderer.render( scene, camera );
	// remove map
	mesh.material.map = null;
	mesh.material.needsUpdate = true;


	setGUI();
	setMaterial();
	animate();
	
	function setGUI(){
		var gui = new dat.GUI();
		var i, l;
		var arr;

		arr = [];
		for(i in setting.material){ arr.push(i); }
		gui.add( materialStatus, 'material', arr ).onChange(function(value) {
			setMaterial();
		});

		var options = gui.addFolder('options');


		options.addColor(materialStatus.option, 'color');
		options.addColor(materialStatus.option, 'ambient');
		options.addColor(materialStatus.option, 'emissive');
		options.addColor(materialStatus.option, 'specular');
		options.add( materialStatus.option, 'shininess', 1, 100 ).step(1);
		options.add( materialStatus.option, 'opacity', 0.0, 1.0 ).step(0.1);

		options.add( materialStatus.option, 'map', [
			'null',
			'./dummy.png',
			'./earth.jpg',
			'./mars.jpg',
			'./venus.jpg'
		] );

		options.add( materialStatus.option, 'bumpMap', [
			'null',
			'./bump_earth.png'
		] );
		options.add( materialStatus.option, 'bumpScale', 1, 10 ).step(1);

		options.add( materialStatus.option, 'reflectivity', 0, 10 ).step(.1);
		options.add( materialStatus.option, 'refractionRatio', 0, 10 ).step(.1);

		options.add( materialStatus.option, 'shading', [
			'SmoothShading',
			'FlatShading',
		]);
		options.add( materialStatus.option, 'depthTest');

		options.add( materialStatus.option, 'wireframe' );
		options.add( materialStatus.option, 'wireframeLinewidth', 1, 10 ).step(1);

		options.add( materialStatus.option, 'visible' );

		for( i = 0, l = options.__controllers.length; i < l; i++){
			options.__controllers[i].onChange(function(value){
				setMaterial();
			});
		}
		return;
	}

	function setMaterial(){
		var params = {};
		var text = [];
		for(var i in materialStatus.option ){
			var val = materialStatus.option[i];
			if( /^#[0-9a-fA-F]{6}$/.test( val ) ){
				params[i] = new THREE.Color( parseInt( val.replace(/#/,'0x'), 16 ) );
				text.push( i + ': new THREE.Color(' + parseInt( val.replace(/#/,'0x'), 16 ) + ')');
			} else if( val === 'null' ){
				params[i] = null;
				text.push( i + ': null');
			} else if(/^.\/.+\.(jpg|png)$/.test( val )){
				params[i] = THREE.ImageUtils.loadTexture( val );
				text.push( i + ': THREE.ImageUtils.loadTexture(' + val + ')');
			} else {
				params[i] = materialStatus.option[i];
				text.push( i + ': ' + val + '');
			}
		}
		params.shading = THREE[params.shading];
		console.log(mesh.material)
		mesh.material = new setting.material[materialStatus.material]( params );

		console.log(text)
	}


	function animate(){
		var timer = Date.now() * 0.1;
		camera.position.x = 60 * Math.sin( timer * Math.PI / 360 );
		camera.position.y = 20 * Math.sin( timer * Math.PI / 360 );
		camera.position.z = 60 * Math.cos( timer * Math.PI / 360 );
		camera.lookAt( new THREE.Vector3( 0, 0, 0) );
		renderer.render( scene, camera );
		requestAnimationFrame(animate);
		return;
	};

	return;
}, false);
</script>
</head>
<body>
</body>
</html>
